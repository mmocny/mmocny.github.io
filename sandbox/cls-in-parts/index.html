<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLS test</title>
    <style>
        p {
            height: 200px;
            width: 80%;
            background-color: lightblue;
        }
    </style>
</head>
<body>
    <p>
        This is the main content of the page.
    </p>

<script>
    function perf$(types, options = { buffered: true, durationThreshold: 0 }) {
    if (typeof types === 'string') {
        types = [types];
    }

    return new Observable(subscriber => {
        const observer = new PerformanceObserver(list => {
            for (const entry of list.getEntries()) {
                subscriber.next(entry);
            }
        });

        for (let type of types) {
            observer.observe({ type, ...options });
        }

        return () => observer.disconnect();
    })
}

let cls = 0;
perf$('layout-shift').forEach(entry => {
    cls += entry.value;
    console.log(cls.toFixed(4),entry.value.toFixed(4), entry);
});
</script>
<script>
    const p = document.body.querySelector('p');
    p.style.position = 'relative'; // So 'top' property works

    const totalPixelsToShift = 1000;
    const numberOfShifts = 1;
    const shiftAmountPerInterval = totalPixelsToShift / numberOfShifts;

    let shiftCount = 0;
    const interval = setInterval(() => {
        if (shiftCount >= numberOfShifts) {
            clearInterval(interval);
            return;
        }
        shiftCount++;
        // This will cause a layout shift
        p.style.top = `${shiftCount * shiftAmountPerInterval}px`;
    }, 20);
</script>
</body>
</html>
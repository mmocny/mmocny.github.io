<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Timing Shadow DOM Hover</title>
</head>
<body>
    <style>
        div {
            border: 1px green solid;
            margin: 0;
            padding: 0;
        }
    </style>

    <h2>Shadow dom + Hover effects text</h2>
    <p>The Green border wraps a div shadow root host, the black border wraps a span inside the shadow dom.</p>
    <p>In Chrome m142 there is an inconsistent behaviour where if you hover over the span, the targetting depends on where you hover from.  Try to move mouse from the bottom of the page directly onto the black border span, or try to move mouse first to the green border box and then onto the black box.  Notice the differences in the Event Timing API logs (target value).  If you register explicit event listeners, you notice differences in event dispatch itself.</p>

    <p>
        <div id="shadowHost"></div>
    </p>
    <p>
        <div id="openShadowHost"></div>
    </p>

    <script>
        function registerListeners(target, types = ["click", "mouseover"]) {
            for (let type of types) {
                target.addEventListener(type, (e) => {
                    console.log(`EventListener(${type}) for:`, target, "is targetting:", e.target);
                    busy(100);
                });
            }
        };
        
        function busy(ms) {
            const target = performance.now() + ms;
            while (performance.now() < target);
        }

        function createComponent(shadowHost, mode) {
            const shadowRoot = shadowHost.attachShadow({mode});
            const innerSpan = document.createElement("span");
            innerSpan.style = "border:1px black solid;";
            innerSpan.textContent = mode;
            registerListeners(innerSpan);
            shadowRoot.append(innerSpan);
        }

        registerListeners(document.body);
        createComponent(document.getElementById('shadowHost'), 'closed');
        createComponent(document.getElementById('openShadowHost'), 'open');

        new PerformanceObserver(list => {
            for (let entry of list.getEntries()) {
                console.log('EventTiming:', entry.name, entry.target);
            }
        }).observe({type: 'event', durationThreshold: 0});

  </script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Timing Shadow DOM Hover</title>
</head>
<body>
    <style>
        div {
            border: 1px green solid;
            margin: 0;
            padding: 0;
        }
    </style>

    <h2>Shadow dom + Hover effects text</h2>
    <p>The Green border wraps a div shadow root host, the black border wraps a span inside the shadow dom.</p>
    <p>In Chrome m142 there is an inconsistent behaviour where if you hover over the span, the targetting depends on where you hover from.  Try to move mouse from the bottom of the page directly onto the black border span, or try to move mouse first to the green border box and then onto the black box.  Notice the differences in the Event Timing API logs (target value).  If you register explicit event listeners, you notice differences in event dispatch itself.</p>

    <p>
    <button onclick="registerListener(document.body)">Add body mouseover listener</button>
    <button onclick="registerListener(shadowHost)">Add shadow root mouseover listener</button>
    </p>

    <p>
        <div id="shadowHost"></div>
    </p>
    <p>
        <div id="openShadowHost"></div>
    </p>

    <script>
        function registerListener(target) {
            target.addEventListener("mouseover", (e) => {
                console.log("EventListener(mouseover) for", target, "is targetting:", e.target);
            });
        };
        
        function busy(ms) {
            const target = performance.now() + ms;
            while (performance.now() < target);
        }

        function createComponent(shadowHost, mode) {
            const shadowRoot = shadowHost.attachShadow({mode});
            const innerSpan = document.createElement("span");
            innerSpan.style = "border:1px black solid;";
            innerSpan.textContent = mode;
            innerSpan.addEventListener("mouseover", function(e) {
                // To make this is a slow event
                busy(100);
            });
            shadowRoot.append(innerSpan);
        }

        createComponent(document.getElementById('shadowHost'), 'closed');
        createComponent(document.getElementById('openShadowHost'), 'open');
        

        new PerformanceObserver(entryList => {
            for (let entry of entryList.getEntriesByName("mouseover")) {
                console.log('EventTiming:', entry.name, entry.target);
            }
        }).observe({type: 'event', durationThreshold: 0});

  </script>